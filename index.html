<!DOCTYPE html>

<html>

<head>
  <title>Personal Finance Dashboard</title>
  <link rel="stylesheet" href="./assets/bootstrap.min.css">
  <script src="./assets/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://kit.fontawesome.com/7d5a1b1b0d.js" crossorigin="anonymous"></script>
  <script src="./assets/finance-calculator.js"></script>
  <script src="./assets/finance-record.js"></script>
  <style>
    .summary>div {
      border-top: 1px solid black;
    }
  </style>
</head>

<body>
  <!-- #region header -->

  <nav class="p-2 navbar bg-primary text-light mb-3">
    <h3>Personal Finance Dashboard</h3>
    <label for="import-year" class="btn btn-secondary">Import Year</label>
    <input type="file" id="import-year" accept="json" class="d-none" onchange="FinanceRecord.import_year()">
  </nav>


  <!-- #endregion -->

  <!-- #region main -->

  <main class="px-2">
    <div>

      <!-- #region year-month-menu -->
      <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#year-modal">New Year</button>
      <div class="row">
        <div class="col-3">
          <label for="year" class="form-label fw-bold">Year</label>
          <select id="year-select" class="form-select mb-3" onchange="FinanceRecord.cur_year = this.value"></select>
        </div>
        <div class="col-3">
          <label for="month" class="form-label fw-bold">Month</label>
          <select id="month-select" class="form-select mb-3" onchange="FinanceRecord.cur_month = this.value">
            <option value="0" selected>January</option>
            <option value="1">February</option>
            <option value="2">March</option>
            <option value="3">April</option>
            <option value="4">May</option>
            <option value="5">June</option>
            <option value="6">July</option>
            <option value="7">August</option>
            <option value="8">September</option>
            <option value="9">October</option>
            <option value="10">November</option>
            <option value="11">December</option>
          </select>
        </div>
      </div>

      <div id="year-modal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Enter Year</h5>
            </div>
            <div class="modal-body">
              <input type="text" value="" id="year" class="form-control">
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" onclick="FinanceRecord.new_year();"
                data-bs-dismiss="modal">Submit</button>
            </div>
          </div>
        </div>
      </div>
      <!-- #endregion -->

      <btn class="btn btn-primary" id="export" style="display: none;" onclick="FinanceRecord.export_year()">Export Year
      </btn>


    </div>

    <!-- #region tabs -->
    <ul class="nav nav-tabs my-3" id="nav-tabs" style="display: none;">
      <li class="nav-item">
        <a class="nav-link" id="income-link" onclick="show_tab('income')">Income</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="expenses-link" onclick="show_tab('expenses')">Expenses</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="accounts-link" onclick="show_tab('accounts')">Accounts</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="assets-link" onclick="show_tab('assets')">Assets</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="loans-link" onclick="show_tab('loans')">Loans</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="summary-link" onclick="show_tab('summary')">Summary</a>
      </li>
    </ul>
    <!-- #endregion -->

    <!-- #region income-tab -->
    <div id='income-tab' style="display: none;">
      <div class="w-100 d-flex flex-column align-items-center mb-3">
        <h4>Income</h4>
        <button class="btn btn-outline-primary mb-3" data-bs-toggle="modal" data-bs-target="#income-modal">Add
          Income</button>

        <div class="d-flex justify-content-between w-75">
          <div>
            <h5>Ian's Income</h5>
            <table class="table table-striped" style="max-width: 250px;">
              <tbody id="income-table-ian">
              </tbody>
            </table>

          </div>

          <div>
            <h5>Marty's Income</h5>
            <table class="table table-striped" style="max-width: 250px;">
              <tbody id="income-table-marty">
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div id="income-modal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Enter Income</h5>
            </div>
            <div class="modal-body">
              <input type="hidden" value="-1" id="income-id">
              <div class="form-group">
                <label class="form-label fw-bold" for="income-name">Income Name</label>
                <input type="text" value="" id="income-name" class="form-control">
              </div>
              <div class="form-group">
                <label class="form-label fw-bold" for="income-amount">Income Amount</label>
                <input type="number" value="" id="income-amount" class="form-control">
              </div>
              <div class="form-group">
                <label class="form-label fw-bold" for="income-person">Person</label>
                <select id="income-person" class="form-select">
                  <option value="ian" selected>Ian</option>
                  <option value="marty">Marty</option>
                </select>
              </div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" onclick="FinanceRecord.new_record('income');"
                data-bs-dismiss="modal">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- #endregion -->

    <!-- #region expenses-tab -->
    <div id='expenses-tab' style="display: none;">
      <div class="w-100 d-flex flex-column align-items-center mb-3">
        <h4>Expenses</h4>
        <button class="btn btn-outline-primary mb-3" data-bs-toggle="modal" data-bs-target="#expenses-modal">Add
          Expense</button>

        <div class="d-flex justify-content-between w-75">
          <div>
            <h5>Shared Expenses</h5>
            <table class="table table-striped mb-5" style="max-width: 250px;">
              <tbody id="expenses-table-shared">
              </tbody>
            </table>
          </div>

          <div>
            <h5>Ian's Expenses</h5>
            <table class="table table-striped mb-5" style="max-width: 250px;">
              <tbody id="expenses-table-ian">
              </tbody>
            </table>
          </div>

          <div>
            <h5>Marty's Expenses</h5>
            <table class="table table-striped mb-5" style="max-width: 250px;">
              <tbody id="expenses-table-marty">
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="expenses-modal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Enter Expense</h5>
            </div>
            <div class="modal-body">
              <input id="expenses-id" type="hidden" val="-1">
              <div class="mb-3">
                <label for="expenses-name" class="form-label fw-bold">Expense Name</label>
                <input type="text" value="" id="expenses-name" class="form-control">
              </div>
              <div class="mb-3">
                <label for="expenses-amount" class="form-label fw-bold">Expense Amount</label>
                <input type="number" value="" id="expenses-amount" class="form-control">
              </div>
              <div class="mb-3">
                <label for="expenses-category" class="form-label fw-bold">Expense Category</label>
                <select id="expenses-category" class="form-select">
                  <option value="electricity">Electricity</option>
                  <option value="food">Food</option>
                  <option value="fun">Fun</option>
                  <option value="gas">Gas</option>
                  <option value="groceries">Groceries</option>
                  <option value="house">House</option>
                  <option value="insurance">Insurnace</option>
                  <option value="internet">Internet</option>
                  <option value="loans">Loans</option>
                  <option value="medical">Medical</option>
                  <option value="rent">Rent</option>
                  <option value="subscriptions">Subscriptions</option>
                  <option value="travel">Travel</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="expenses-person" class="form-label fw-bold">Person</label>
                <select id="expenses-person" class="form-select">
                  <option value="ian">Ian</option>
                  <option value="marty">Marty</option>
                  <option value="shared">Shared</option>
                </select>
              </div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" onclick="FinanceRecord.new_record('expenses');"
                data-bs-dismiss="modal">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- #endregion -->

    <!-- #region accounts-tab -->
    <div id='accounts-tab' style="display: none;">
      <div class="w-100 d-flex flex-column align-items-center mb-3">
        <h4>Accounts</h4>
        <button class="btn btn-outline-primary mb-3" data-bs-toggle="modal" data-bs-target="#accounts-modal">Add Accounts</button>

        <div class="d-flex justify-content-between w-75">
          <div>
            <h5>Ian's Accounts</h5>
            <table class="table table-striped" style="max-width: 300px;">
              <tbody id="accounts-table-ian"></tbody>
            </table>
          </div>

          <div>
            <h5>Marty's Accounts</h5>
            <table class="table table-striped w-75 mb-5" style="max-width: 300px;">
              <tbody id="accounts-table-marty"></tbody>
            </table>
          </div>

          <div>
            <h5>Shared Accounts</h5>
            <table class="table table-striped w-75 mb-5" style="max-width: 300px;">
              <tbody id="accounts-table-shared"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="accounts-modal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Enter Account</h5>
            </div>
            <div class="modal-body">
              <input id="accounts-id" type="hidden" value="-1">
              <div class="mb-3">
                <label for="accounts-name" class="form-label fw-bold">Account Name</label>
                <input type="text" value="" id="accounts-name" class="form-control">
              </div>
              <div class="mb-3">
                <label for="accounts-amount" class="form-label fw-bold">Account Start Amount</label>
                <input type="number" value="" id="accounts-amount" class="form-control">
              </div>
              <div class="mb-3">
                <label for="accounts-endamount" class="form-label fw-bold">Account End Amount</label>
                <input type="number" value="" id="accounts-endamount" class="form-control">
              </div>
              <div class="mb-3">
                <label for="accounts-person" class="form-label fw-bold">Person</label>
                <select id="accounts-person" class="form-select">
                  <option value="ian">Ian</option>
                  <option value="marty">Marty</option>
                  <option value="shared">Shared</option>
                </select>
              </div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" onclick="FinanceRecord.new_record('accounts');"
                data-bs-dismiss="modal">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- #endregion -->

    <!-- #region assets-tab -->
    <div id="assets-tab" style="display: none;">

      <div class="w-100 d-flex flex-column align-items-center mb-3">
        <h4>Assets</h4>
        <button class="btn btn-outline-primary mb-3" data-bs-toggle="modal" data-bs-target="#assets-modal">Add Asset</button>

        <div class="d-flex justify-content-between w-75">
          <div>
            <h5>Ian's Assets</h5>
            <table class="table table-striped" style="max-width: 250px;">
              <tbody id="assets-table-ian"></tbody>
            </table>
          </div>

          <div>

            <h5>Marty's Assets</h5>
            <table class="table table-striped mb-5" style="max-width: 250px;">
              <tbody id="assets-table-marty"></tbody>
            </table>
          </div>

          <div>
            <h5>Shared Assets</h5>
            <table class="table table-striped mb-5" style="max-width: 250px;">
              <tbody id="assets-table-shared"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="assets-modal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Enter Asset</h5>
            </div>
            <div class="modal-body">
              <input id="assets-id" type="hidden" value="-1">
              <div class="mb-3">
                <label for="assets-name" class="form-label fw-bold">Asset Name</label>
                <input type="text" value="" id="assets-name" class="form-control">
              </div>
              <div class="mb-3">
                <label for="assets-amount" class="form-label fw-bold">Asset Start Amount</label>
                <input type="number" value="" id="assets-amount" class="form-control">
              </div>
              <div class="mb-3">
                <label for="assets-endamount" class="form-label fw-bold">Asset End Amount</label>
                <input type="number" value="" id="assets-endamount" class="form-control">
              </div>
              <div class="mb-3">
                <label for="assets-person" class="form-label fw-bold">Person</label>
                <select id="assets-person" class="form-select">
                  <option value="ian">Ian</option>
                  <option value="marty">Marty</option>
                  <option value="shared">Shared</option>
                </select>
              </div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" onclick="FinanceRecord.new_record('assets');"
                data-bs-dismiss="modal">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- endregion -->

    <!-- #region loans-tab -->
    <div id="loans-tab" style="display: none;">

      <div class="w-100 d-flex flex-column align-items-center mb-3">
        <h4>Loans</h4>
        <button class="btn btn-outline-primary mb-3" data-bs-toggle="modal" data-bs-target="#loans-modal">Add Loan</button>

        <div class="d-flex justify-content-between w-75">
          <div>
            <h5>Ian's Loans</h5>
            <table class="table table-striped" style="max-width: 250px;">
              <tbody id="loans-table-ian"></tbody>
            </table>
          </div>

          <div>
            <h5>Marty's Loans</h5>
            <table class="table table-striped" style="max-width: 250px;">
              <tbody id="loans-table-marty"></tbody>
            </table>
          </div>

          <div>
            <h5>Shared Loans</h5>
            <table class="table table-striped" style="max-width: 250px;">
              <tbody id="loans-table-shared"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="loans-modal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Enter Loan</h5>
            </div>
            <div class="modal-body">
              <input id="loans-id" type="hidden" value="-1">
              <div class="mb-3">
                <label for="loans-name" class="form-label fw-bold">Loan Name</label>
                <input type="text" value="" id="loans-name" class="form-control">
              </div>
              <div class="mb-3">
                <label for="loans-amount" class="form-label fw-bold">Loan Start Amount</label>
                <input type="number" value="" id="loans-amount" class="form-control">
              </div>
              <div class="mb-3">
                <label for="loans-endamount" class="form-label fw-bold">Loan End Amount</label>
                <input type="number" value="" id="loans-endamount" class="form-control">
              </div>
              <div class="mb-3">
                <label for="loans-person" class="form-label fw-bold">Person</label>
                <select id="loans-person" class="form-select">
                  <option value="ian">Ian</option>
                  <option value="marty">Marty</option>
                  <option value="shared">Shared</option>
                </select>
              </div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" onclick="FinanceRecord.new_record('loans');"
                data-bs-dismiss="modal">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- #endregion -->

    <!-- #region summary-tab -->
    <div id="summary-tab" style="display: none;">
      <button class="btn btn-primary" onclick="print_summary()">Print Summary</button>
      <div id="print" class="w-100 d-flex flex-column align-items-center summary">
        <h4 id="summary-title">Summary</h4>

        <div class="d-flex justify-content-between w-75 my-1">
          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Income</td>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Total Income Ian</td>
                  <td id="total-income-ian" class="text-success"></td>
                </tr>
                <tr>
                  <td>Total Income Marty</td>
                  <td id="total-income-marty" class="text-success"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Expenses Ian</td>
                </tr>
              </thead>
              <tbody id="summary-expenses-ian">
                <tr>
                  <td>Total</td>
                  <td id="total-expenses-ian" class="text-danger"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Expenses Marty</td>
                </tr>
              </thead>
              <tbody id="summary-expenses-marty">
                <tr>
                  <td>Total</td>
                  <td id="total-expenses-marty" class="text-danger"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Shared Expenses</td>
                </tr>
              </thead>
              <tbody id="summary-expenses-shared">
                <tr>
                  <td>Total Shared Expenses</td>
                  <td id="total-expenses-shared" class="text-danger"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>



        <div class="d-flex justify-content-between w-75 my-1">
          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Accounts Ian</td>
                </tr>
              </thead>
              <tbody id="summary-accounts-ian">
                <tr>
                  <td>Total</td>
                  <td id="total-accounts-ian" class="text-success"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Accounts Marty</td>
                </tr>
              </thead>
              <tbody id="summary-accounts-marty">
                <tr>
                  <td>Total</td>
                  <td id="total-accounts-marty" class="text-success"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Accounts Shared</td>
                </tr>
              </thead>
              <tbody id="summary-accounts-shared">
                <tr>
                  <td>Total</td>
                  <td id="total-accounts-shared" class="text-success"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>



        <div class="d-flex justify-content-between w-75 my-1">
          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Assets Ian</td>
                </tr>
              </thead>
              <tbody id="summary-assets-ian">
                <tr>
                  <td>Total</td>
                  <td id="total-assets-ian" class="text-success"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Assets Marty</td>
                </tr>
              </thead>
              <tbody id="summary-assets-marty">
                <tr>
                  <td>Total</td>
                  <td id="total-assets-marty" class="text-success"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Assets Shared</td>
                </tr>
              </thead>
              <tbody id="summary-assets-shared">
                <tr>
                  <td>Total</td>
                  <td id="total-assets-shared" class="text-success"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>



        <div class="d-flex justify-content-between w-75 my-1">
          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Loans Ian</td>
                </tr>
              </thead>
              <tbody id="summary-loans-ian">
                <tr>
                  <td>Total</td>
                  <td id="total-loans-ian" class="text-danger"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Loans Marty</td>
                </tr>
              </thead>
              <tbody id="summary-loans-marty">
                <tr>
                  <td>Total</td>
                  <td id="total-loans-marty" class="text-danger"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Loans Shared</td>
                </tr>
              </thead>
              <tbody id="summary-loans-shared">
                <tr>
                  <td>Total</td>
                  <td id="total-loans-shared" class="text-danger"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>



        <div class="d-flex justify-content-between w-75 my-1">
          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Total Assets</td>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Total Assets Ian</td>
                  <td id="assets-ian"></td>
                </tr>
                <tr>
                  <td>Total Assets Marty</td>
                  <td id="assets-marty"></td>
                </tr>
                <tr>
                  <td>Combined Assets</td>
                  <td class="text-success" id="assets-shared"></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Total Debts</td>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Total Debts Ian</td>
                  <td id="debts-ian"></td>
                </tr>
                <tr>
                  <td>Total Debts Marty</td>
                  <td id="debts-marty"></td>
                </tr>
                <tr>
                  <td>Combined Debts</td>
                  <td class="text-danger" id="debts-shared"></td>
                </tr>
              </tbody>
            </table>
          </div>


          <div>
            <table class="table table-striped">
              <thead>
                <tr>
                  <td class="fw-bold">Net Worth</td>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Net Worth Ian</td>
                  <td id="net-worth-ian"></td>
                </tr>
                <tr>
                  <td>Net Worth Marty</td>
                  <td id="net-worth-marty"></td>
                </tr>
                <tr>
                  <td>Combined Net Worth</td>
                  <td id="net-worth-shared"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- #endregion -->
  </main>
  <!-- #endregion -->

  <script>
    const hide_tabs = () => {
      const tab_names = $('.nav-link').toArray().map(x => x.getHTML().toLowerCase())
      for (const tab_name of tab_names) {
        $(`#${tab_name}-tab`).hide();
        $(`#${tab_name}-link`).removeClass('active')
      }
    };

    const show_tab = (tab_name) => {
      if (tab_name === 'summary') {
        refresh_summary();
      }

      hide_tabs();
      $(`#${tab_name}-tab`).show();
      $(`#${tab_name}-link`).addClass('active');
    };

    const reset_form = (type) => {
      const inputs = $(`#${type}-modal`).find('input');

      for (const input of inputs) {
        input.value = '';

        if (input.id.split('-')[1] == 'id') {
          input.value = '-1';
        }
      }
    };

    const refresh_summary = () => {
      const months = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];

      $('#summary-title').html(`${months[FinanceRecord.cur_month]}, ${FinanceRecord.cur_year} - Summary`)

      const finance_calc = new FinanceCalculator();
      const income = finance_calc.get_total_income();

      $('#total-income-ian').html(`${income.ian.toLocaleString("en-US", {style:"currency", currency:"USD"})}`);
      $('#total-income-marty').html(`${income.marty.toLocaleString("en-US", {style:"currency", currency:"USD"})}`);

      const expenses = finance_calc.get_expenses();
      summary_table_refresh('expenses', expenses);

      const accounts = finance_calc.get_accounts();
      summary_table_refresh('accounts', accounts);

      const assets = finance_calc.get_assets();
      summary_table_refresh('assets', assets);

      const loans = finance_calc.get_loans();
      summary_table_refresh('loans', loans);

      const asset_totals = finance_calc.get_combined_asset_totals();
      const debt_totals = finance_calc.get_combined_debt_totals();
      const net_worth = finance_calc.get_net_worth();

      if (net_worth.shared < 0) {
        $('#net-worth-shared').removeClass();
        $('#net-worth-shared').addClass('text-danger');
      }
      else if (net_worth.shared > 0) {
        $('#net-worth-shared').removeClass();
        $('#net-worth-shared').addClass('text-success');
      }
      else {
        $('#net-worth-shared').removeClass();
      }

      combined_totals_refresh('assets', asset_totals);
      combined_totals_refresh('debts', debt_totals);
      combined_totals_refresh('net-worth', net_worth);
    };

    const combined_totals_refresh = (type, data) => {
      for (let [person, amount] of Object.entries(data)) {
        $(`#${type}-${person}`).html(`${amount.toLocaleString("en-US", {style:"currency", currency:"USD"})}`);
      }
    }

    const summary_table_refresh = (type, type_records) => {
      const totals = {};

      for (let [person, records] of Object.entries(type_records)) {
        totals[person] = {};

        for (let [category, amount] of Object.entries(records)) {
          if (totals[person][category] === undefined) {
            totals[person][category] = 0;
          }

          totals[person][category] += amount;

        }

        let total = 0;

        const table_children = $(`#summary-${type}-${person}`).children();
        $(`#summary-${type}-${person}`).html(table_children[table_children.length - 1]);

        for (let [category, amount] of Object.entries(totals[person])) {
          total += amount;
          const cat = category[0].toUpperCase() + category.slice(1);
          const cat_tr = $(`<tr><td>${cat}</td><td>${amount.toLocaleString("en-US", {style:"currency", currency:"USD"})}</td></tr>`);
          $(`#summary-${type}-${person}`).prepend(cat_tr);
        }

        $(`#total-${type}-${person}`).html(`${total.toLocaleString("en-US", {style:"currency", currency:"USD"})}`);
      }
    }

    const new_record_body = (type, id, record) => {
      if (type === 'income' || record.endamount === '') {
        return new_record_success_button(type, id, `$${record.amount}`);
      }
      else if (type === 'expenses') {
        return new_record_danger_button(type, id, `$${record.amount} - ${record.category[0].toUpperCase() + record.category.slice(1)}`);
      }
      else if (type === 'loans') {
        return record.amount > record.endamount
          ? new_record_success_button(type, id, `$${record.amount} <i class="fa-solid fa-arrow-right"></i> $${record.endamount}`)
          : new_record_danger_button(type, id, `$${record.amount} <i class="fa-solid fa-arrow-right"></i> $${record.endamount}`);
      }

      return record.amount <= record.endamount
        ? new_record_success_button(type, id, `$${record.amount} <i class="fa-solid fa-arrow-right"></i> $${record.endamount}`)
        : new_record_danger_button(type, id, `$${record.amount} <i class="fa-solid fa-arrow-right"></i> $${record.endamount}`);
    }

    const new_record_success_button = (type, id, label) => {
      return `<button onclick="FinanceRecord.edit_record('${type}', ${id})" class="btn btn-outline-success">${label}</button>`;
    }

    const new_record_danger_button = (type, id, label) => {
      return `<button onclick="FinanceRecord.edit_record('${type}', ${id})" class="btn btn-outline-danger">${label}</button>`;
    }

    const new_record_delete_button = (type, id) => {
      return `<button class="btn btn-danger" onclick="FinanceRecord.delete_record('${type}', ${id})"><i class="fa-solid fa-trash"></i></button>`;
    }

    const refresh_table = (type) => {
      const records = FinanceRecord.get_records_table(type);

      $(`#${type}-table-ian`).html('');
      $(`#${type}-table-marty`).html('');
      $(`#${type}-table-shared`)?.html('');

      for (const id in records) {
        const tr = $('<tr></tr>');
        const td = $(`<td><h6>${records[id].name}</h6></td>`);
        const body = $('<div class="d-flex justify-content-between"></div>');

        body.append(new_record_body(type, id, records[id]));
        body.append(new_record_delete_button(type, id));

        td.append(body);
        tr.append(td);

        $(`#${type}-table-${records[id].person}`).append(tr);
      }
    };

    const refresh_tables = () => {
      const links = $('.nav-link');

      for (const link of links) {
        refresh_table(link.text.toLowerCase());
      }
    };

    $('#year-select,#month-select').on('change', () => {
      $('#nav-tabs').show();
      $('#export').show();
      refresh_tables();
      refresh_summary();
    });

    const print_summary = () => {

      const summary = document.getElementById("print");
      const print = window.open('', '', 'left=0,top=0,width=1000,height=1000,toolbar=0,scrollbars=0,status=0');

      print.document.write(`
      <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
        <style>
          .summary > div {
            border-top: 1px solid black;
          }
        </style>
      </head>
      `);
      print.document.write(summary.innerHTML);
      print.document.close();
      print.focus();
      print.print();
      print.close();
    };
  </script>
</body>

</html>